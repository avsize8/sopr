"""–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∑–∞–ø—É—Å–∫–∞"""
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message, InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from aiogram.utils.keyboard import InlineKeyboardBuilder

router = Router() 


@router.message(Command("start"))
async def cmd_start(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    # –°–æ–∑–¥–∞–µ–º –∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫—É "–ü—Ä–∏—Å—Ç—É–ø–∏—Ç—å"
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="–ü—Ä–∏—Å—Ç—É–ø–∏—Ç—å ‚ñ∂Ô∏è", callback_data="start_menu")]
        ]
    )
    
    await message.answer(
        f"–ü—Ä–∏–≤–µ—Ç, <b>{message.from_user.first_name}</b>! üëã\n"
        f"–≠—Ç–æ —Ç–≤–æ–π –ø–æ–º–æ—à–Ω–∏–∫ –ø—Ä–∏ –ß–°\n"
        f"–ò—Å–ø–æ–ª—å–∑—É–π /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.",
        reply_markup=keyboard
    )

@router.callback_query(F.data == "start_menu")
async def show_emergency_menu(callback: CallbackQuery):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Å —Å–∏—Ç—É–∞—Ü–∏—è–º–∏"""
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Å–∏—Ç—É–∞—Ü–∏—è–º–∏
    builder = InlineKeyboardBuilder()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏
    situations = [
        "üöó –ü–æ–ø–∞–ª –≤ –∞–≤–∞—Ä–∏—é",
        "üè† –ü–æ–∂–∞—Ä –≤ –¥–æ–º–µ", 
        "üå™Ô∏è –°—Ç–∏—Ö–∏–π–Ω–æ–µ –±–µ–¥—Å—Ç–≤–∏–µ",
        "üè• –¢—Ä–µ–±—É–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å",
        "üöì –ü—Ä–æ–∏–∑–æ—à–µ–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç",
        "üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏",
        "üíß –ó–∞—Ç–æ–ø–ª–µ–Ω–∏–µ",
        "‚ö° –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞"
    ]
    
    for situation in situations:
        builder.add(InlineKeyboardButton(
            text=situation, 
            callback_data=f"situation_{situations.index(situation)}"
        ))
    
    # –†–∞—Å–ø–æ–ª–∞–≥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ 2 –≤ —Ä—è–¥
    builder.adjust(2)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    builder.row(InlineKeyboardButton(text="–ù–∞–∑–∞–¥ ‚óÄÔ∏è", callback_data="back_to_start"))
    
    await callback.message.edit_text(
        "üìã <b>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é:</b>\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏",
        reply_markup=builder.as_markup()
    )
    await callback.answer()

@router.callback_query(F.data == "back_to_start")
async def back_to_start(callback: CallbackQuery):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é"""
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="–ü—Ä–∏—Å—Ç—É–ø–∏—Ç—å ‚ñ∂Ô∏è", callback_data="start_menu")]
        ]
    )
    
    await callback.message.edit_text(
        f"–ü—Ä–∏–≤–µ—Ç, <b>{callback.from_user.first_name}</b>! üëã\n"
        f"–≠—Ç–æ —Ç–≤–æ–π –ø–æ–º–æ—à–Ω–∏–∫ –ø—Ä–∏ –ß–°\n"
        f"–ò—Å–ø–æ–ª—å–∑—É–π /help –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.",
        reply_markup=keyboard
    )
    await callback.answer()

@router.callback_query(F.data.startswith("situation_"))
async def handle_situation(callback: CallbackQuery):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏"""
    situation_id = int(callback.data.split("_")[1])
    
    situations = [
        "üöó –ü–æ–ø–∞–ª –≤ –∞–≤–∞—Ä–∏—é",
        "üè† –ü–æ–∂–∞—Ä –≤ –¥–æ–º–µ", 
        "üå™Ô∏è –°—Ç–∏—Ö–∏–π–Ω–æ–µ –±–µ–¥—Å—Ç–≤–∏–µ",
        "üè• –¢—Ä–µ–±—É–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å",
        "üöì –ü—Ä–æ–∏–∑–æ—à–µ–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç",
        "üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏",
        "üíß –ó–∞—Ç–æ–ø–ª–µ–Ω–∏–µ",
        "‚ö° –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞"
    ]
    
    selected_situation = situations[situation_id]
    
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
    situation_instructions = {
        "üöó –ü–æ–ø–∞–ª –≤ –∞–≤–∞—Ä–∏—é": "1. –û—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n2. –í—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é (103)\n3. –°–æ–æ–±—â–∏—Ç–µ –≤ –ì–ò–ë–î–î (102)",
        "üè† –ü–æ–∂–∞—Ä –≤ –¥–æ–º–µ": "1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–∫–∏–Ω—å—Ç–µ –ø–æ–º–µ—â–µ–Ω–∏–µ\n2. –í—ã–∑–æ–≤–∏—Ç–µ –ø–æ–∂–∞—Ä–Ω—ã—Ö (101)\n3. –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ —Å–æ—Å–µ–¥–µ–π",
        "üå™Ô∏è –°—Ç–∏—Ö–∏–π–Ω–æ–µ –±–µ–¥—Å—Ç–≤–∏–µ": "1. –ù–∞–π–¥–∏—Ç–µ —É–∫—Ä—ã—Ç–∏–µ\n2. –°–ª–µ–¥—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º\n3. –î–µ—Ä–∂–∏—Ç–µ –ø–æ–¥ —Ä—É–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç—ã",
        "üè• –¢—Ä–µ–±—É–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ø–æ–º–æ—â—å": "1. –í—ã–∑–æ–≤–∏—Ç–µ —Å–∫–æ—Ä—É—é (103)\n2. –û–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–≤—É—é –ø–æ–º–æ—â—å\n3. –°–æ–æ–±—â–∏—Ç–µ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º",
        "üöì –ü—Ä–æ–∏–∑–æ—à–µ–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç": "1. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ\n2. –í—ã–∑–æ–≤–∏—Ç–µ –ø–æ–ª–∏—Ü–∏—é (102)\n3. –ù–∞–π–¥–∏—Ç–µ —Å–≤–∏–¥–µ—Ç–µ–ª–µ–π",
        "üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏": "1. –ù–µ –ø–∞–Ω–∏–∫—É–π—Ç–µ\n2. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –≤ –ú–ß–° (101)\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–æ—Å–µ–¥—è–º–∏",
        "üíß –ó–∞—Ç–æ–ø–ª–µ–Ω–∏–µ": "1. –ü–µ—Ä–µ–∫—Ä–æ–π—Ç–µ –≤–æ–¥—É\n2. –û—Ç–∫–ª—é—á–∏—Ç–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ\n3. –í—ã–∑–æ–≤–∏—Ç–µ –∞–≤–∞—Ä–∏–π–Ω—É—é —Å–ª—É–∂–±—É",
        "‚ö° –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞": "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å–µ–¥–µ–π\n2. –ü–æ–∑–≤–æ–Ω–∏—Ç–µ –≤ –∞–≤–∞—Ä–∏–π–Ω—É—é —Å–ª—É–∂–±—É\n3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ–Ω–∞—Ä—å"
    }
    
    instruction = situation_instructions.get(selected_situation, "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞.")
    
    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –º–µ–Ω—é
    keyboard = InlineKeyboardMarkup(
        inline_keyboard=[
            [InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é", callback_data="start_menu")],
            [InlineKeyboardButton(text="üè† –í –Ω–∞—á–∞–ª–æ", callback_data="back_to_start")]
        ]
    )
    
    await callback.message.edit_text(
        f"<b>{selected_situation}</b>\n\n"
        f"{instruction}",
        reply_markup=keyboard
    )
    await callback.answer()